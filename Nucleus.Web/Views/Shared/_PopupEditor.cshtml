@* This layout is used by the "edit (current) page settings, and the module settings editor popups. *@
@using Nucleus.ViewFeatures.HtmlHelpers
@using Nucleus.Abstractions
<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width" />
	<meta charset="utf-8">
	<meta content="text/html" http-equiv="Content-Type" />
	<title>Nucleus Editor</title>
	@Html.AddStyle("~/Resources/Libraries/Bootstrap/5.1.0/css/bootstrap.css")
	@Html.AddStyle("~/Resources/css/main.css")
	@Html.AddStyle("~/Resources/css/shared.css")
	@Html.AddStyle("~/Resources/css/admin.css")
	@Html.AddStyle("~/Resources/css/forms.css")
	@Html.AddScript("~/Resources/Libraries/jQuery/03.06.00/jquery.min.js")
	@Html.AddScript("~/Resources/Libraries/Bootstrap/5.1.0/js/bootstrap.bundle.js")
	@Html.AddScript("~/Resources/js/jquery-toggleswitch.js")
	@Html.AddScript("~/Resources/js/jquery-pagelist.js")
	@Html.AddScript("~/Resources/js/nucleus-shared.js")
	@Html.AddScript("~/Resources/js/nucleus-admin.js")
	@Html.AddHtmlEditor()
	<merge-stylesheets>
	@Html.RenderStyles()
	</merge-stylesheets>
	<merge-scripts>
	@Html.RenderScripts()
	</merge-scripts>
</head>
<body>
	<div class="nucleus-adminpage nucleus-admin-content nucleus-settings-frame">
		@RenderBody()
	</div>
	<modal id="PopupDialog" title="Settings"></modal>
	
	<script type="text/javascript">
		jQuery(Page).on("ready.admin", _handleContentLoaded);

		jQuery(document).ready(function ()
		{
			// initialize popup after initial iframe load
			_initializePopup();
		});

		function _handleContentLoaded(event, page, target, data, url, triggerEvent, status, request)
		{
			// initialize popup after partial content update
			if (data !== '')
			{
				_initializePopup();
			}
		}

		function _initializePopup()
		{
			// If the content contains a heading caption, and we are in an iframe, set the iframe title to its content.  InitFrame will automatically set the modal's caption to the iframe title.
			if (window.frameElement)
			{
				var heading = jQuery('.nucleus-modal-caption').first();
				if (heading.length !== 0)
				{
					jQuery(window.frameElement).attr('title', heading.html());
					heading.remove();
				}
			}

			// Set the target of forms to form.parent() for the module edit view 'save' button, controller methods generally return no content.
			jQuery('form').each(function (index, element)
			{
				element = jQuery(element);

				if (typeof (element.attr('data-target')) === 'undefined' || element.attr('data-target') === '')
				{
					element.attr('data-target', 'form.parent()');
				}
			});

			// Show the modal which contains the popup editor iframe
			if (window.frameElement)
			{
				window.parent.document.dispatchEvent(new CustomEvent('InitFrame', { detail: { element: window.frameElement } }));
			}
		}
	</script>
</body>

</html>
