/*! nucleus-editmode | Nucleus inline editing client-side handlers and behaviours | (c) Inventua Pty Ptd.  www.nucleus-cms.com */
function _setupEditMode(){function r(n){return n.css("display")==="flex"&&n.css("flex-direction")==="row"?!0:n.css("display")==="inline-flex"&&n.css("flex-direction")==="row"?!0:n.is("td")?!0:n.css("float")==="left"?!0:!1}function u(t){var i=jQuery(t.target);i.addClass("dragging");jQuery(".nucleus-move-droptarget").each(function(n,r){var u=jQuery(r),e=i.parents(".nucleus-module-editing"),f=u.parents(".nucleus-module-editing");f.is(jQuery(t.target).parents(".nucleus-module-editing"))||f.length===0&&u.parent().is(e.parent())&&u.is(":last-child")||u.addClass("show")});t.originalEvent.dataTransfer.effectAllowed="move";n=jQuery(t.target).attr("data-mid")}function f(t){var i=jQuery(t.target).attr("data-mid");n!==null&&n!==i?(jQuery(t.target).addClass("drag-active"),t.originalEvent.dataTransfer.dropEffect="move"):t.originalEvent.dataTransfer.dropEffect="none"}function e(t){var i=jQuery(t.target).attr("data-mid");n!==null&&n!==i&&t.preventDefault()}function o(n){jQuery(n.target).removeClass("drag-active")}function s(t){jQuery(t.target).removeClass("dragging");jQuery(".nucleus-move-droptarget").removeClass("show");n=null}function h(t){var r=jQuery(t.target).attr("data-pane-name"),u=jQuery(t.target).attr("data-mid"),f,i;r!==null&&n!==null&&(f=document.baseURI+"admin/pages/movemoduleto?mid="+n,i=new FormData,i.append("pane",r),typeof u!="undefined"&&i.append("beforeModuleId",u),jQuery.ajax({url:f,"async":!0,method:"POST",enctype:"multipart/form-data",data:i,headers:{Accept:"application/json, */*"},contentType:!1,processData:!1,success:function(){window.location.reload(!0)},error:function(){}}))}function c(n){return![13].includes(n.keyCode)&&(!n.ctrlKey||![66,98,73,105,65,117].includes(n.keyCode))}function l(n){if(n.preventDefault(),content=(n.originalEvent||n).clipboardData?.getData("text/plain"),content){var t=window.getSelection().getRangeAt(0);t&&(t.deleteContents(),t.insertNode(document.createTextNode(content)),window.getSelection().collapseToEnd())}}function i(n){n.keyCode===32&&n.stopImmediatePropagation()}function a(n){var t;return n.keyCode===13?(t=window.getSelection().getRangeAt(0),t&&(t.deleteContents(),t.insertNode(document.createElement("br")),window.getSelection().collapseToEnd()),!1):!n.ctrlKey||![66,98,73,105,65,117].includes(n.keyCode)}function v(n){var t,i,r;if(n.preventDefault(),content=(n.originalEvent||n).clipboardData?.getData("text/plain"),content&&(t=window.getSelection().getRangeAt(0),t)){for(t.deleteContents(),i=document.createElement("template"),i.innerHTML=content.replaceAll("\n","<br>"),r=i.content.childNodes.length-1;r>=0;r--)t.insertNode(i.content.childNodes[r]);window.getSelection().collapseToEnd()}}function y(){t>0&&window.clearTimeout(t);t=window.setTimeout(p,1e3,this)}function p(n){var u=jQuery(n),c=u.attr("data-inline-edit-route"),f=u.attr("data-inline-edit-mode"),s,r,t,i,e,o,h;typeof f!="unspecified"&&f!==null&&(f==="SingleLineText"||f==="MultiLineText"?(s=n.innerText,r=n.innerHTML.replaceAll(/<br([^>]*)>/gi,"\n").replaceAll(/&nbsp;/gi,"Â "),r!==s&&(t=window.getSelection().getRangeAt(0),t&&t.commonAncestorContainer.data&&n.childNodes.length>0&&(t.commonAncestorContainer.data!==s?(i=u.text().indexOf(t.commonAncestorContainer.data),selectionFinish=i+t?.commonAncestorContainer.data.length):(i=t.startOffset,selectionFinish=t.endOffset)),e=document.createElement("div"),e.innerHTML=r.replaceAll("<br>","\n"),r=e.innerText,u.html(e.innerText.replaceAll("\n","<br>")),i&&i>=0&&(o=document.createRange(),o.setStart(n.childNodes[0],i),o.setEnd(n.childNodes[0],i),window.getSelection().removeAllRanges(),window.getSelection().addRange(o)))):r=u.html(),h=new FormData,h.append("value",r),jQuery.ajax({url:c,"async":!0,method:"POST",enctype:"multipart/form-data",data:h,headers:{Accept:"application/json, */*"},contentType:!1,processData:!1,success:function(){},error:function(n,t,i){console.error(i)}}))}var n=null,t;jQuery(".nucleus-module-editing *[data-inline-edit-route]").prop("contenteditable","true").on("input blur",y);jQuery('.nucleus-module-editing *[data-inline-edit-route][data-inline-edit-mode = "MultiLineText"]').on("keydown",a).on("keyup",i).on("paste",v);jQuery('.nucleus-module-editing *[data-inline-edit-route][data-inline-edit-mode = "SingleLineText"]').on("keydown",c).on("keyup",i).on("paste",l);jQuery(".nucleus-move-dragsource").on("dragstart",u).on("dragend",s);jQuery(".nucleus-move-droptarget").on("dragenter",f).on("dragover",e).on("dragleave",o).on("drop",h);jQuery(".nucleus-move-droptarget").each(function(n,t){var i=jQuery(t),u=i.parent();(u.prev().length!==0&&u.prev().position().top===u.position().top||u.next().length!==0&&u.next().position().top===u.position().top||i.prev().length!==0&&i.prev().position().top===i.position().top||i.next().length!==0&&i.next().position().top===i.position().top)&&r(u)&&i.addClass("sideways")});t=-1}jQuery(Page).on("ready.admin",_setupEditMode);